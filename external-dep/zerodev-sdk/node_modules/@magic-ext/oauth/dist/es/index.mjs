var u=(r,t,e)=>new Promise((i,o)=>{var c=a=>{try{d(e.next(a))}catch(s){o(s)}},p=a=>{try{d(e.throw(a))}catch(s){o(s)}},d=a=>a.done?i(a.value):Promise.resolve(a.value).then(c,p);d((e=e.apply(r,t)).next())});import{Extension as O}from"@magic-sdk/commons";var f=(t=>(t.ParseRedirectResult="magic_oauth_parse_redirect_result",t))(f||{}),I=(n=>(n.InvalidRequest="invalid_request",n.InvalidClient="invalid_client",n.InvalidScope="invalid_scope",n.InvalidGrant="invalid_grant",n.UnauthorizedClient="unauthorized_client",n.UnsupportedResponseType="unsupported_response_type",n.UnsupportedGrantType="unsupported_grant_type",n.UnsupportedTokenType="unsupported_token_type",n.AccessDenied="access_denied",n.ServerError="server_error",n.TemporarilyUnavailable="temporarily_unavailable",n))(I||{});import R from"crypto-js";var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",A=typeof window!="undefined"&&!!window.crypto,b=A&&!!window.crypto.subtle;function w(r){return Array.from(r).map(t=>m[t%m.length]).join("")}function y(r){let t=e=>e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(r instanceof ArrayBuffer){let e=new Uint8Array(r),i=Array.from(e).map(c=>String.fromCharCode(c)).join(""),o=btoa(i);return t(o)}return t(R.enc.Base64.stringify(r))}function U(r){return u(this,null,function*(){if(b){let t=new TextEncoder().encode(r);return crypto.subtle.digest("SHA-256",t).then(y)}return y(R.SHA256(r))})}function h(r){let t=new Uint8Array(r);if(A)window.crypto.getRandomValues(t);else for(let e=0;e<r;e+=1)t[e]=Math.floor(Math.random()*Math.floor(255));return w(t)}function v(){return u(this,null,function*(){let r=h(128),t=h(128),e=yield U(t);return{verifier:t,challenge:e,state:r}})}var _=class extends O.Internal{constructor(){super(...arguments);this.name="oauth";this.config={};this.compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1,"@magic-sdk/react-native-bare":!1,"@magic-sdk/react-native-expo":!1}}loginWithRedirect(e){return this.utils.createPromiEvent(i=>u(this,null,function*(){let{provider:o,query:c}=yield C.call(this,e);window.location.href=new URL(`/v1/oauth2/${o}/start?${c}`,this.sdk.endpoint).href,i()}))}getRedirectResult(){let e=window.location.search,i=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",i),x.call(this,e)}},g="oauth_redirect_metadata";function C(r){return u(this,null,function*(){yield this.utils.storage.removeItem(g);let{provider:t,redirectURI:e,scope:i,loginHint:o}=r,{verifier:c,challenge:p,state:d}=yield v(),a=JSON.stringify({verifier:c,state:d});return yield this.utils.storage.setItem(g,a),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(p)}`,`state=${encodeURIComponent(d)}`,`platform=${encodeURIComponent("web")}`,i&&`scope=${encodeURIComponent(i.join(" "))}`,e&&`redirect_uri=${encodeURIComponent(e)}`,o&&`login_hint=${encodeURIComponent(o)}`].reduce((l,n)=>n?`${l}&${n}`:l),provider:t,redirectURI:e}})}function x(r){return this.utils.createPromiEvent((t,e)=>u(this,null,function*(){var l;let i=yield this.utils.storage.getItem(g),{verifier:o,state:c}=JSON.parse(i);this.utils.storage.removeItem(g);let p=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[r,o,c]),d=yield this.request(p),a=d,s=d;s.error&&e(this.createError(s.error,(l=s.error_description)!=null?l:"An error occurred.",{errorURI:s.error_uri,provider:s.provider})),t(a)}))}export{I as OAuthErrorCode,_ as OAuthExtension,f as OAuthPayloadMethods};
//# sourceMappingURL=index.mjs.map
