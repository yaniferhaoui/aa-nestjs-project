"use strict";var O=Object.create;var g=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var k=(e,t)=>{for(var r in t)g(e,r,{get:t[r],enumerable:!0})},R=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of x(t))!T.call(e,n)&&n!==r&&g(e,n,{get:()=>t[n],enumerable:!(i=C(t,n))||i.enumerable});return e};var E=(e,t,r)=>(r=e!=null?O(D(e)):{},R(t||!e||!e.__esModule?g(r,"default",{value:e,enumerable:!0}):r,e)),P=e=>R(g({},"__esModule",{value:!0}),e);var u=(e,t,r)=>new Promise((i,n)=>{var c=a=>{try{d(r.next(a))}catch(s){n(s)}},p=a=>{try{d(r.throw(a))}catch(s){n(s)}},d=a=>a.done?i(a.value):Promise.resolve(a.value).then(c,p);d((r=r.apply(e,t)).next())});var q={};k(q,{OAuthErrorCode:()=>A,OAuthExtension:()=>h,OAuthPayloadMethods:()=>m});module.exports=P(q);var U=require("@magic-sdk/commons");var m=(t=>(t.ParseRedirectResult="magic_oauth_parse_redirect_result",t))(m||{}),A=(o=>(o.InvalidRequest="invalid_request",o.InvalidClient="invalid_client",o.InvalidScope="invalid_scope",o.InvalidGrant="invalid_grant",o.UnauthorizedClient="unauthorized_client",o.UnsupportedResponseType="unsupported_response_type",o.UnsupportedGrantType="unsupported_grant_type",o.UnsupportedTokenType="unsupported_token_type",o.AccessDenied="access_denied",o.ServerError="server_error",o.TemporarilyUnavailable="temporarily_unavailable",o))(A||{});var y=E(require("crypto-js"));var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",b=typeof window!="undefined"&&!!window.crypto,S=b&&!!window.crypto.subtle;function B(e){return Array.from(e).map(t=>v[t%v.length]).join("")}function _(e){let t=r=>r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(e instanceof ArrayBuffer){let r=new Uint8Array(e),i=Array.from(r).map(c=>String.fromCharCode(c)).join(""),n=btoa(i);return t(n)}return t(y.default.enc.Base64.stringify(e))}function $(e){return u(this,null,function*(){if(S){let t=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",t).then(_)}return _(y.default.SHA256(e))})}function I(e){let t=new Uint8Array(e);if(b)window.crypto.getRandomValues(t);else for(let r=0;r<e;r+=1)t[r]=Math.floor(Math.random()*Math.floor(255));return B(t)}function w(){return u(this,null,function*(){let e=I(128),t=I(128),r=yield $(t);return{verifier:t,challenge:r,state:e}})}var h=class extends U.Extension.Internal{constructor(){super(...arguments);this.name="oauth";this.config={};this.compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1,"@magic-sdk/react-native-bare":!1,"@magic-sdk/react-native-expo":!1}}loginWithRedirect(r){return this.utils.createPromiEvent(i=>u(this,null,function*(){let{provider:n,query:c}=yield H.call(this,r);window.location.href=new URL(`/v1/oauth2/${n}/start?${c}`,this.sdk.endpoint).href,i()}))}getRedirectResult(){let r=window.location.search,i=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",i),M.call(this,r)}},f="oauth_redirect_metadata";function H(e){return u(this,null,function*(){yield this.utils.storage.removeItem(f);let{provider:t,redirectURI:r,scope:i,loginHint:n}=e,{verifier:c,challenge:p,state:d}=yield w(),a=JSON.stringify({verifier:c,state:d});return yield this.utils.storage.setItem(f,a),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(p)}`,`state=${encodeURIComponent(d)}`,`platform=${encodeURIComponent("web")}`,i&&`scope=${encodeURIComponent(i.join(" "))}`,r&&`redirect_uri=${encodeURIComponent(r)}`,n&&`login_hint=${encodeURIComponent(n)}`].reduce((l,o)=>o?`${l}&${o}`:l),provider:t,redirectURI:r}})}function M(e){return this.utils.createPromiEvent((t,r)=>u(this,null,function*(){var l;let i=yield this.utils.storage.getItem(f),{verifier:n,state:c}=JSON.parse(i);this.utils.storage.removeItem(f);let p=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[e,n,c]),d=yield this.request(p),a=d,s=d;s.error&&r(this.createError(s.error,(l=s.error_description)!=null?l:"An error occurred.",{errorURI:s.error_uri,provider:s.provider})),t(a)}))}
//# sourceMappingURL=index.js.map
